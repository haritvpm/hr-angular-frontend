<div>
  <form [formGroup]="searchForm" class="row justify-content-between">
    <mat-form-field class="m-x-8 flex-grow-1" appearance="outline">
      <mat-label>Date</mat-label>
      <!-- <input matInput [matDatepicker]="picker" placeholder="Choose a date" (dateChange)="dateChanged('change', $event)"> -->
      <input
        readonly
        [max]="todayDate"
        [min]="beginDate"
        matInput
        [matDatepicker]="picker"
        [formControl]="date"
        (dateChange)="dateChanged('change', $event)"
      />
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>

    <mat-form-field class="m-x-8 flex-grow-1" appearance="outline">
      <mat-label>Section</mat-label>
      <mat-select formControlName="selectedSection" (selectionChange)="applyFilter()">
        @for (section of sections; track section) {
          <mat-option [value]="section">{{ section }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field class="m-x-8 flex-grow-1" appearance="outline">
      <mat-label>Search</mat-label>
      <!-- <input matInput #searchInput (keyup)="applyFilter(searchInput.value)" /> -->
      <input matInput formControlName="searchTxt" (keyup)="applyFilter()" placeholder="Search" />
    </mat-form-field>
  </form>
</div>

<!-- <div class="mat-elevation-z1 mat-table-responsive"> -->
<div class="mat-elevation-z1">
  <div class="table-container">
    <table mat-table [dataSource]="dataSource" matSort (matSortChange)="announceSortChange($event)">
      <ng-container matColumnDef="name" sticky>
        <th mat-header-cell [style.text-align]="'center'" *matHeaderCellDef sticky>
          <div class="d-flex align-items-center">
            <button mat-icon-button (click)="onPrevDay()">
              <mat-icon>chevron_left</mat-icon>
            </button>

            <!-- <b [style.color]="is_holiday ? 'red' : ''">{{ selectedDateHint }}</b> -->
            <b>{{ selectedDateHint }}</b>

            <span *ngIf="is_holiday" [style.color]="'red'">&nbsp;(H)</span>
            <span *ngIf="calender?.office_ends_at === '3pm'" [style.color]="'red'"
              >&nbsp;(3p.m.)</span
            >
            <span *ngIf="calender?.office_ends_at === 'noon'" [style.color]="'red'"
              >&nbsp;(Noon)</span
            >

            <button mat-icon-button (click)="onNextDay()">
              <mat-icon>chevron_right</mat-icon>
            </button>
          </div>
        </th>
        <td mat-cell [style.white-space]="'nowrap'" *matCellDef="let employee">
          <a [routerLink]="['/attendance/employee', employee.aadhaarid, date_dmY]">
            <small>{{ employee.aadhaarid }}</small
            >&nbsp; <b>{{ employee.name }}</b
            ><br /><small>{{ employee.designation }}</small>
          </a>
        </td>
      </ng-container>

      <ng-container matColumnDef="section">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          sortActionDescription="Sort by section"
        >
          Section
        </th>
        <td mat-cell *matCellDef="let employee">{{ employee.section }}</td>
      </ng-container>

      <ng-container matColumnDef="flexi_time">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          sortActionDescription="Sort by flexi_time"
        >
          Time Slot
        </th>
        <td mat-cell *matCellDef="let employee">{{ employee.flexi_time }}</td>
      </ng-container>
      <ng-container matColumnDef="inTrace">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          sortActionDescription="Sort by in date"
        >
          In
        </th>

        <td mat-cell *matCellDef="let employee" (click)="mark(employee)">
          {{ employee?.in_time }}
          <span
            *ngIf="!employee.punchin_trace && !is_holiday"
            [style.color]="employee.single_punch_regularised_by ? '' : 'DeepPink'"
            [matTooltip]="getTooltipContent(employee)"
            matTooltipPosition="above"
            [matTooltipShowDelay]="500"
            matTooltipClass="allow-cr"
          >
            <small><mat-icon>close</mat-icon></small></span
          >
          <span *ngIf="employee.grace_total_exceeded_one_hour" [style.color]="'red'">
            <small>>1H</small>
          </span>

          <span *ngIf="employee.single_punch_regularised_by">
            {{ employee?.controller_set_punch_in | date: 'HH:mm' }}
          </span>
        </td>
        <!-- <td mat-cell [style.color]="employee.punchin_trace?.att_time > '10:30:00'? 'red': ''" *matCellDef="let employee">{{ employee.punchin_trace?.att_time }}</td> -->
        <!-- <td mat-cell [style]="getPunchInStyle(employee)" *matCellDef="let employee">{{ employee.punchin_trace?.att_time }}</td> -->
      </ng-container>
      <ng-container matColumnDef="outTrace">
        <th
          mat-header-cell
          [style.text-align]="'center'"
          *matHeaderCellDef
          mat-sort-header
          sortActionDescription="Sort by out time"
        >
          Out
        </th>
        <td mat-cell *matCellDef="let employee" (click)="mark(employee)">
          {{ employee?.out_time }}
          <span
            *ngIf="!employee.punchout_trace && !is_today && !is_holiday"
            [style.color]="employee.single_punch_regularised_by ? '' : 'DeepPink'"
            [matTooltip]="getTooltipContent(employee)"
            matTooltipPosition="above"
            [matTooltipShowDelay]="500"
            matTooltipClass="allow-cr"
          >
            <small><mat-icon>close</mat-icon></small></span
          >

          <span *ngIf="employee.single_punch_regularised_by">
            {{ employee?.controller_set_punch_out | date: 'HH:mm' }}
          </span>
        </td>
      </ng-container>
      <ng-container matColumnDef="duration_str">
        <th
          mat-header-cell
          [style.text-align]="'center'"
          *matHeaderCellDef
          mat-sort-header
          sortActionDescription="Sort by duration_str"
        >
          Duration
        </th>

        <td mat-cell *matCellDef="let employee" (click)="mark(employee)">
          <app-duration-cell
            [punching]="employee"
            [is_today]="is_today"
            [is_holiday]="is_holiday"
          ></app-duration-cell>
        </td>
      </ng-container>
      <ng-container matColumnDef="extra_str">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          sortActionDescription="Sort by out time"
        >
          Extra(Day)
        </th>
        <td mat-cell *matCellDef="let employee">{{ employee.extra_str }}</td>
      </ng-container>
      <ng-container matColumnDef="total_extra_sec">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          sortActionDescription="Sort by grace time"
        >
          Extra(Month)
        </th>
        <td mat-cell [style]="getExtratimeColor(employee)" *matCellDef="let employee">
          <span *ngIf="!is_holiday">
            <!-- {{ roundValue(employee.total_extra_sec / 60) }} -->
            {{ employee.total_extra_str }}
          </span>
        </td>
      </ng-container>
      <ng-container matColumnDef="grace_str">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          sortActionDescription="Sort by grace time"
        >
          Grace(Day)
        </th>
        <td
          mat-cell
          [style]="getGraceStyle(employee)"
          *matCellDef="let employee"
          (click)="mark(employee)"
        >
          {{ employee.grace_str }}
        </td>
      </ng-container>
      <!-- <ng-container matColumnDef="total_grace_sec">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          sortActionDescription="Sort by grace time"
        >
          GrUsed(Month)
        </th>
        <td mat-cell [style]="getGraceStyleTotal(employee)" *matCellDef="let employee" (click)="mark(employee)">
          <span *ngIf="!is_holiday">
            {{ roundValue(employee.total_grace_sec / 60) }}
          </span>
        </td>
      </ng-container> -->

      <ng-container matColumnDef="grace_left">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          sortActionDescription="Sort by grace time left"
        >
          GrRem(Month)
        </th>
        <td mat-cell [style]="getGraceStyleTotal(employee)" *matCellDef="let employee">
          <span *ngIf="!is_holiday">
            <!-- {{ 300 - roundValue(employee.total_grace_sec / 60) }} -->
              {{employee.grace_limit - roundValue(employee.total_grace_sec / 60)}}

          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="cl_mark_sub">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          sortActionDescription="Sort by CL Mark Sub"
        >
          CL <br />
          Mark|Sub ({{ date_dmY | date: 'yyyy' }})
        </th>
        <td mat-cell *matCellDef="let punchinfo">
          <!-- <span *ngIf="!is_holiday">
            {{ 300 - roundValue(employee.total_grace_sec / 60) }}
          </span> -->
          {{ punchinfo.cl_marked }} / {{ punchinfo.cl_submitted }}
        </td>
      </ng-container>

      <ng-container matColumnDef="comb_mark_sub">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          sortActionDescription="Sort by Comp Mark Sub"
        >
          Comp <br />
          Mark|Sub ({{ date_dmY | date: 'yyyy' }})
        </th>
        <td mat-cell *matCellDef="let punchinfo">
          <!-- <span *ngIf="!is_holiday">
            {{ 300 - roundValue(employee.total_grace_sec / 60) }}
          </span> -->
          {{ punchinfo.compen_marked }} / {{ punchinfo.compen_submitted }}
        </td>
      </ng-container>

      <ng-container matColumnDef="remarks">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          sortActionDescription="Sort by remarks"
        >
          Remarks
        </th>
        <td mat-cell *matCellDef="let employee">
          {{ employee.remarks }}
        </td>
      </ng-container>

      <!-- <td mat-cell [style.color]="employee.name.startsWith('V')?'red':'blue'" *matCellDef="let employee">{{ employee.name }} <p style="white-space: pre-wrap"></p>{{ employee.designation }}</td> -->

      <!-- Symbol Column -->
      <!-- <ng-container matColumnDef="symbol">
    <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by views">
      Views
    </th>
    <td mat-cell *matCellDef="let employee"> {{ employee.views }} </td>
  </ng-container> -->

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
  <mat-paginator
    #paginator
    [pageSizeOptions]="[50, 100, 200]"
    showFirstLastButtons
    aria-label="Select page"
  >
  </mat-paginator>
</div>
