<!-- here, create a form for applying leave -->
<h1>Leave Application</h1>

@if (errorMessage.length) {
  @for (e of errorMessage; track e) {
    <mtx-alert type="warning"> {{ e }}</mtx-alert>
  }
}

@if (holidaysInPeriod.length) {

   <mtx-alert type="info"> Holidays in Period :  {{ holidaysInPeriod.toString() }} </mtx-alert>

}
<form class="example-container" [formGroup]="applyLeaveForm" >
  <div class="d-flex row">
    <mat-form-field class="col" appearance="fill">
      <mat-label>Leave Type</mat-label>
      <mat-select formControlName="leaveType">
        @for (leavetype of leaveapplyTypes; track leavetype) {
          <mat-option [value]="leavetype.value">{{ leavetype.label }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
    @if(applyLeaveForm.get('fromDate')?.value && applyLeaveForm.get('leaveCount')!.value! > 0){
    <mat-form-field class="col" appearance="outline">
      <mat-label>Days</mat-label>
      <input
        matInput
        type="number"
        formControlName="leaveCount"
        placeholder="Days"
        readonly="true"
      />
    </mat-form-field>
  }
  </div>

  @if(applyLeaveForm.get('leaveType')?.value){
  <div class="d-flex row align-items-stretch justify-content-center">
    <mat-form-field class="col" appearance="fill">
      <mat-label> {{showingPeriod ? 'Leave date (from)' : 'Leave date'}}</mat-label>
      <input matInput [matDatepicker]="pickerf"  (focus)="pickerf.open()" (click)="pickerf.open()"
      [max]="fromDateMax"
      formControlName="fromDate" readonly="true" />
      <!-- <mat-hint>YYYY-MM-DD</mat-hint> -->
      <mat-datepicker-toggle matIconSuffix [for]="pickerf"></mat-datepicker-toggle>

      <mat-datepicker #pickerf></mat-datepicker>
    </mat-form-field>

    <!-- if casual leave is selected, fromType should be full, an, fn otherwise just hide, but its value should be full -->
    @if (applyLeaveForm.get('leaveType')?.value === 'casual') {
      <mat-form-field class="col" appearance="fill">
        <mat-label>Type</mat-label>
        <mat-select formControlName="fromType">
          @for (fromtype of casualFromTypes; track fromtype) {
            <mat-option [value]="fromtype.value">{{ fromtype.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    }

    @if( showingPeriod && applyLeaveForm.get('leaveType')?.value !== 'compen_for_extra'){

    <mat-form-field class="col" appearance="fill">
      <mat-label>To date</mat-label>
      <input
        [min]="isCasualOrCompen ? casualMinDate : applyLeaveForm.get('fromDate')?.value"
        matInput
        (focus)="picker.open()"
        (click)="picker.open()"
        [matDatepicker]="picker"
        formControlName="toDate"
        readonly="true"
      />
      <!-- <mat-hint>YYYY-MM-DD</mat-hint> -->
      <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker-toggle matSuffix (click)="clearEndDate()">
        <mat-icon matDatepickerToggleIcon>clear</mat-icon>
      </mat-datepicker-toggle>
      <mat-datepicker #picker [disabled]="!applyLeaveForm.get('fromDate')?.value"></mat-datepicker>
    </mat-form-field>
    <!-- if casual leave is selected, toType should be full, an, fn otherwise just hide, but its value should be full -->
    @if (applyLeaveForm.get('leaveType')?.value === 'casual') {
      <mat-form-field class="col"  appearance="fill">
        <mat-label>Type</mat-label>
        <mat-select formControlName="toType">
          @for (totype of casualToTypes; track totype) {
            <mat-option [value]="totype.value">{{ totype.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    }
  } @else if (applyLeaveForm.get('leaveType')?.value !== 'compen_for_extra'){
    <!-- a button which will show the period on click -->

    <button class="m-l-4" mat-button color="primary" (click)="showPeriod()">Multiple days...</button>
  }

  </div>

  <!-- for compen, we need in lie of -->
  <div class="d-flex row">
    @if (applyLeaveForm.get('leaveType')?.value === 'compen') {
      <mat-form-field class="col">
        <ngx-multiple-dates
          [matDatepicker]="compenpicker"
          placeholder="Compensation for dates"
          name="compensationDates"
          formControlName="inLieofDates"
          [closeOnSelected]="true"
          [required]="applyLeaveForm.get('leaveType')?.value === 'compen'"
          [max]="compenMaxDate"
          [min]="compenMinDate"
          [minlength]="applyLeaveForm.get('leaveCount')?.value || 1"
          [maxlength]="applyLeaveForm.get('leaveCount')?.value || 1"
        >
        </ngx-multiple-dates>
        <mat-datepicker-toggle matPrefix [for]="compenpicker"></mat-datepicker-toggle>
        <mat-datepicker #compenpicker></mat-datepicker>
      </mat-form-field>
    } @else if (applyLeaveForm.get('leaveType')?.value === 'compen_for_extra') {
      <mat-form-field class="col">
        <mat-label>Compensation for month</mat-label>
        <mat-select formControlName="inLieofMonth">
          @for (inlieof of inLieofMonths; track inlieof) {
            <mat-option [value]="inlieof.value">{{ inlieof.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    }
  </div>
  <div class="d-flex row">
    <mat-form-field class="col" appearance="fill">
      <mat-label>Reason</mat-label>
      <input matInput formControlName="reason" placeholder="Reason for leave" />
      <!-- <mat-hint>Reason for leave</mat-hint> -->
      @if (applyLeaveForm.hasError('required')) {
        <mat-error>Reason is <strong>required</strong></mat-error>
      }
    </mat-form-field>
  </div>
}
  <div class="d-flex row">
    <div class="col d-flex justify-content-end">
      <button mat-flat-button
      [disabled]="isSubmitting || !applyLeaveForm.valid ||
      (holidaysInPeriod.length >0 && isCasualOrCompen )"
      color="accent"
      (click)="applyLeave()"
      >Apply Leave</button>
      <button mat-flat-button class="m-l-4" color="primary"   (click)="cancel()">Cancel</button>
    </div>
  </div>

</form>

{{ applyLeaveForm.value | json }}
{{ applyLeaveForm.valid }}
holidaysInPeriod:{{holidaysInPeriod.length}}
{{isCasualOrCompen }}
