<!-- search form -->
<div>
  <form [formGroup]="searchForm" class="row justify-content-between">
    <mat-form-field class="m-x-8 flex-grow-1" appearance="outline">
      <mat-label>Month and Year</mat-label>
      <input
             readonly
             [max]="todayDate"
             [min]="beginDate"
             matInput
             [matDatepicker]="dp"
             [formControl]="date" />
      <!-- <mat-hint>{{selectedMonthHint}}</mat-hint> -->
      <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
      <mat-datepicker
                      #dp
                      startView="year"
                      (monthSelected)="chosenMonthHandler($event, dp)">
      </mat-datepicker>
    </mat-form-field>

    <mat-form-field class="m-x-8 flex-grow-1" appearance="outline">
      <mat-label>Section</mat-label>
      <mat-select formControlName="selectedSection" (selectionChange)="applyFilter()">
        @for (section of sections; track section) {
        <mat-option [value]="section">{{ section }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field class="m-x-8 flex-grow-1" appearance="outline">
      <mat-label>Search</mat-label>
      <input matInput formControlName="searchTxt" (keyup)="applyFilter()" placeholder="Search" />
    </mat-form-field>
  </form>
</div>

<!-- progress -->
<div *ngIf="isLoading">
  <mat-progress-bar [color]="'accent'" mode="query"></mat-progress-bar>
</div>

<!-- table -->

<div class="mat-elevation-z1">
  <div class="table-container">
    <table mat-table [dataSource]="dataSource">
      <ng-container matColumnDef="name" sticky>
        <th mat-header-cell [style.text-align]="'right'" *matHeaderCellDef>

          <div class=" d-flex  align-items-center">
            <button mat-icon-button (click)="onPrevMonth()">
              <mat-icon>chevron_left</mat-icon>
            </button>

            {{ selectedMonthHint }}
            <button mat-icon-button (click)="onNextMonth()">
              <mat-icon>chevron_right</mat-icon>
            </button>
          </div>
        </th>
        <td mat-cell [style.white-space]="'nowrap'" *matCellDef="let row">
          <a [routerLink]="['/attendance/monthwiseregister/employee', row.aadhaarid, row.start_date ]">
            <small>{{ row.aadhaarid }}</small>&nbsp; <b> {{ row.name }} </b><br />
            <small>{{ row?.designation }}</small>
          </a>
        </td>
      </ng-container>
      <ng-container matColumnDef="grace_left">
        <th mat-header-cell *matHeaderCellDef>GrRem</th>
        <td mat-cell [style]="getGraceStyle(row)" *matCellDef="let row">{{ graceLeft(row) }}</td>
      </ng-container>

      @for (dayN of dayColumns; track dayN) {
      <ng-container [matColumnDef]="dayN">
        <th
            mat-header-cell
            [style.color]="calendarInfo[dayN].future_date? 'lightgray' : calendarInfo[dayN].holiday ? 'red' : ''"
            [style.text-decoration]="calendarInfo[dayN].is_today ? 'underline' : ''"
            [style.text-align]="'center'"
            [style.padding]="'0 0'"
            *matHeaderCellDef>
          <b> {{ calendarInfo[dayN].d_ }}</b>
        </th>
        <td
            (click)="mark(dayN, row[dayN], row)"
            mat-cell
            [matTooltip]="getTooltip(dayN, row)"
            matTooltipClass="allow-cr"
            [matTooltipShowDelay]="500"
            [style.background-color]="getCellBackgroundColor(dayN, $odd)"
            [style.text-align]="'center'"
            *matCellDef="let row">
          <app-cell [item]="row[dayN]" [calendarInfo]="calendarInfo[dayN]"> </app-cell>
        </td>
      </ng-container>
      }

      <ng-container matColumnDef="CL">
        <th mat-header-cell *matHeaderCellDef>CL <br> Mark|Sub ({{selectedMonth | date: 'yyyy'}})</th>
        <td mat-cell *matCellDef="let row">{{ row.cl_marked }} / {{ row.cl_submitted }}</td>
      </ng-container>
      <ng-container matColumnDef="comp">
        <th mat-header-cell *matHeaderCellDef>Comp <br> Mark|Sub ({{selectedMonth | date: 'yyyy'}})</th>
        <td mat-cell *matCellDef="let row"> {{ row.compen_marked }}  / {{ row.compen_submitted }}</td>
      </ng-container>
      <ng-container matColumnDef="extra">
        <th mat-header-cell *matHeaderCellDef>Extra</th>
        <td mat-cell [style]="getExtraStyle(row)" *matCellDef="let row">
          {{ row.total_extra_str }}
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
  <mat-paginator
                 #paginator
                 [pageSizeOptions]="[50, 100, 200]"
                 showFirstLastButtons
                 aria-label="Select page">
  </mat-paginator>
</div>
